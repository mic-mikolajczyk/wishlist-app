{% extends 'base.html' %}
{% block title %}Events Dashboard{% endblock %}
{% block content %}
<div class="row">
  <div class="col s12">
  <h4>Your Events</h4>
    <a class="btn modal-trigger teal" href="#create-event-modal"><i class="material-icons left">add</i>Create Event</a>
    <ul class="collection" id="events-list">
      {% for event in events %}
      <li class="collection-item event-row" data-event-id="{{ event.id }}" style="cursor:pointer;">
        <span class="title"><b>{{ event.name }}</b></span>
        <p style="margin:0;">
          {% if event.date %}Date: {{ event.date }}{% endif %}
          {% if event.budget_amount %}<br>Budget: {{ event.budget_amount }} {{ event.budget_currency }}{% endif %}
        </p>
      </li>
      {% else %}
      <li class="collection-item grey-text">No active events.</li>
      {% endfor %}
    </ul>
  </div>
</div>
<div class="row">
  <div class="col s12">
    <h5>Pending Invitations</h5>
    <ul class="collection" id="pending-events">
      {% for event in pending_events %}
      <li class="collection-item">
        <span><b>{{ event.name }}</b></span>
        <form method="post" action="{{ url_for('events.accept_invitation', event_id=event.id) }}" style="display:inline;">
          <button class="btn-small green" type="submit">Accept</button>
        </form>
        <form method="post" action="{{ url_for('events.reject_invitation', event_id=event.id) }}" style="display:inline;">
          <button class="btn-small red" type="submit">Reject</button>
        </form>
      </li>
      {% else %}
      <li class="collection-item grey-text">No pending invitations.</li>
      {% endfor %}
    </ul>
  </div>
</div>
</div>

{% if archived_events %}
<div class="row" style="margin-top:2rem;">
  <div class="col s12">
    <h5>Archived Events</h5>
    <ul class="collection" id="archived-events-list">
      {% for event in archived_events %}
      <li class="collection-item event-row" data-event-id="{{ event.id }}" style="cursor:pointer;">
        <span class="title"><b>{{ event.name }}</b></span>
        <span class="new badge grey" data-badge-caption="Archived"></span>
        <p style="margin:0;">
          {% if event.date %}Date: {{ event.date }}{% endif %}
          {% if event.budget_amount %}<br>Budget: {{ event.budget_amount }} {{ event.budget_currency }}{% endif %}
        </p>
      </li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

<!-- Create Event Modal -->
<div id="create-event-modal" class="modal">
  <div class="modal-content">
    <h5>Create Event</h5>
    <form method="post" action="{{ url_for('events.create_event') }}">
      <div class="input-field">
        <input name="name" id="event-name" type="text" required>
        <label for="event-name">Event Name</label>
      </div>
      <div class="input-field">
        <input name="date" id="event-date" type="date">
        <label for="event-date">Date</label>
      </div>
      <div class="input-field">
        <input name="budget_amount" id="event-budget" type="number" step="0.01">
        <label for="event-budget">Budget Amount</label>
      </div>
      <div class="input-field">
        <select name="budget_currency" id="event-currency">
          <option value="PLN" selected>PLN</option>
          <option value="EUR">EUR</option>
          <option value="USD">USD</option>
        </select>
        <label for="event-currency">Currency</label>
      </div>
      <button class="btn teal" type="submit">Create</button>
    </form>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
M.AutoInit();
// Row click navigation for events
document.querySelectorAll('.event-row').forEach(function(row){
  row.addEventListener('click', function(){
    const id=this.getAttribute('data-event-id');
    window.location.href="/events/" + id;
  });
});
</script>
{% endblock %}
